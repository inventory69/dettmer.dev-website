---
import BaseLayout from "./Layout.astro";
const { frontmatter } = Astro.props;
const pageTitle = `${frontmatter.title} | Portfolio | Fabian Dettmer`;

// Generate structured data for projects
const isSimpleNotes = frontmatter.title?.includes("Simple Notes");
const structuredData = isSimpleNotes
  ? {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      name: "Simple Notes Sync",
      alternateName: "simple-notes-sync",
      description: frontmatter.description,
      applicationCategory: "UtilitiesApplication",
      operatingSystem: "Android 8.0+",
      offers: {
        "@type": "Offer",
        price: "0",
        priceCurrency: "EUR",
      },
      author: {
        "@type": "Person",
        name: "Fabian Dettmer",
        url: "https://dettmer.dev",
      },
      downloadUrl: "https://github.com/inventory69/simple-notes-sync/releases/latest",
      installUrl: "https://f-droid.org/packages/dev.dettmer.simplenotes/",
      softwareVersion: "1.5.0",
      screenshot: `https://dettmer.dev${frontmatter.image.url}`,
    }
  : {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      name: frontmatter.title,
      description: frontmatter.description,
      applicationCategory: "DeveloperApplication",
      author: {
        "@type": "Person",
        name: "Fabian Dettmer",
        url: "https://dettmer.dev",
      },
      screenshot: `https://dettmer.dev${frontmatter.image.url}`,
    };

// Breadcrumb structured data
const breadcrumbData = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  itemListElement: [
    {
      "@type": "ListItem",
      position: 1,
      name: "Home",
      item: "https://dettmer.dev",
    },
    {
      "@type": "ListItem",
      position: 2,
      name: "Projects",
      item: "https://dettmer.dev/works/",
    },
    {
      "@type": "ListItem",
      position: 3,
      name: frontmatter.title,
      item: `https://dettmer.dev${Astro.url.pathname}`,
    },
  ],
};
---

<BaseLayout
  pageTitle={pageTitle}
  description={frontmatter.description}
  image={frontmatter.image.url}
>
  <!-- SoftwareApplication Schema -->
  <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />

  <!-- BreadcrumbList Schema -->
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbData)} />

  <div class="gif">
    <img src="/images/laptop.webp" role="presentation" width="300" height="259" decoding="async" />
  </div>
  <h2>{frontmatter.title}</h2>
  <div class="project-images">
    <img
      class="pro-img"
      src={frontmatter.worksImage1.url}
      alt={frontmatter.worksImage1.alt}
      loading="lazy"
    />
    <img
      class="pro-img"
      src={frontmatter.worksImage2.url}
      alt={frontmatter.worksImage2.alt}
      loading="lazy"
    />
  </div>
  <slot />
  <ul class="badge__list">
    <li><span class="badge badge--item">PLATFORM</span>{frontmatter.platform}</li>
    <li><span class="badge badge--item">STACK</span>{frontmatter.stack}</li>
    {
      frontmatter.website && (
        <li>
          <>
            <span class="badge badge--item">WEBSITE</span>
            <a class="badge__link" href={frontmatter.website} target="_blank">
              {frontmatter.website}
            </a>
          </>
        </li>
      )
    }
    {
      frontmatter.github && (
        <li>
          <>
            <span class="badge badge--item">GITHUB</span>
            <a class="badge__link" href={frontmatter.github} target="_blank">
              {frontmatter.github}
            </a>
          </>
        </li>
      )
    }
  </ul>

  <!-- Lightbox Overlay -->
  <div id="lightbox" class="lightbox">
    <img id="lightbox-img" src="" alt="" />
  </div>
</BaseLayout>

<script>
  // Lightbox Funktionalität
  const images = document.querySelectorAll(".pro-img");
  const lightbox = document.getElementById("lightbox");
  const lightboxImg = document.getElementById("lightbox-img");

  images.forEach((img) => {
    img.addEventListener("click", () => {
      lightboxImg.src = img.src;
      lightboxImg.alt = img.alt;
      lightbox.classList.add("active");
    });
  });

  lightbox.addEventListener("click", () => {
    lightbox.classList.remove("active");
  });

  // ESC zum Schließen
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && lightbox.classList.contains("active")) {
      lightbox.classList.remove("active");
    }
  });
</script>
